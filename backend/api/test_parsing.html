<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Verify Filter Results</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .good { background: #d4edda; }
        .bad { background: #f8d7da; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        table { border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f5f5f5; }
        .status-1 { background: #d4edda; }
        .status-0 { background: #f8d7da; }
        .status-null { background: #fff3cd; }
    </style>
</head>
<body>
    <h1>Verify Filter Results</h1>
    
    <div>
        <button onclick="testFilter('No filter', '')">No Filter</button>
        <button onclick="testFilter('Apto (1)', '?status=1')">Apto Only</button>
        <button onclick="testFilter('Inapto (0)', '?status=0')">Inapto Only</button>
        <button onclick="testFilter('Aguardando (null)', '?status=null')">Aguardando Only</button>
    </div>
    
    <div id="results"></div>

    <script>
    function testFilter(title, queryString) {
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = '<p>Loading...</p>';
        
        fetch('../backend/api/get_filtered_teachers.php' + queryString)
            .then(response => response.json())
            .then(data => {
                let html = `<h2>${title}</h2>`;
                html += `<p>Total teachers: ${data.length}</p>`;
                
                if (data.length > 0) {
                    html += '<table>';
                    html += '<tr><th>Teacher</th><th>Disciplines</th></tr>';
                    
                    data.forEach((teacher, index) => {
                        if (index < 5) { // Show first 5
                            html += '<tr>';
                            html += `<td>${teacher.name}</td>`;
                            html += '<td>';
                            
                            if (teacher.discipline_statuses) {
                                const pairs = teacher.discipline_statuses.split('||');
                                pairs.forEach(pair => {
                                    const parts = pair.split(':');
                                    if (parts.length >= 3) {
                                        const id = parts[0];
                                        const status = parts[parts.length - 1];
                                        const name = parts.slice(1, -1).join(':');
                                        
                                        const statusText = status === '1' ? 'Apto' : 
                                                         status === '0' ? 'Inapto' : 'Aguardando';
                                        const statusClass = `status-${status}`;
                                        
                                        html += `<div class="${statusClass}" style="margin: 2px 0; padding: 4px;">`;
                                        html += `${name}: <strong>${statusText}</strong>`;
                                        html += '</div>';
                                    }
                                });
                            }
                            
                            html += '</td>';
                            html += '</tr>';
                        }
                    });
                    
                    html += '</table>';
                    
                    // Verify no wrong statuses
                    html += '<h3>Verification:</h3>';
                    let hasWrongStatus = false;
                    
                    data.forEach(teacher => {
                        if (teacher.discipline_statuses) {
                            const pairs = teacher.discipline_statuses.split('||');
                            pairs.forEach(pair => {
                                const parts = pair.split(':');
                                if (parts.length >= 3) {
                                    const status = parts[parts.length - 1];
                                    
                                    // Check if status matches filter
                                    if (queryString.includes('status=1') && status !== '1') {
                                        hasWrongStatus = true;
                                        html += `<p class="bad">ERROR: Teacher ${teacher.name} has status ${status} in Apto filter!</p>`;
                                    } else if (queryString.includes('status=0') && status !== '0') {
                                        hasWrongStatus = true;
                                        html += `<p class="bad">ERROR: Teacher ${teacher.name} has status ${status} in Inapto filter!</p>`;
                                    } else if (queryString.includes('status=null') && status !== 'null') {
                                        hasWrongStatus = true;
                                        html += `<p class="bad">ERROR: Teacher ${teacher.name} has status ${status} in Aguardando filter!</p>`;
                                    }
                                }
                            });
                        }
                    });
                    
                    if (!hasWrongStatus && queryString.includes('status=')) {
                        html += '<p class="good">âœ“ All statuses match the filter correctly!</p>';
                    }
                }
                
                resultsDiv.innerHTML = html;
            })
            .catch(error => {
                resultsDiv.innerHTML = `<p class="bad">Error: ${error.message}</p>`;
                console.error(error);
            });
    }
    
    // Test on load
    window.onload = () => testFilter('No filter', '');
    </script>
</body>
</html>